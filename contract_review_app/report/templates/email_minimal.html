<!doctype html>
<html lang="{{ 'uk' if settings.get('lang') == 'uk' else 'en' }}">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{ t("report.title") }}</title>
</head>
<body style="margin:0;padding:0;background:#ffffff;color:#111111;font-family:Arial,Helvetica,sans-serif;line-height:1.45;font-size:15px;">
  <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="background:#ffffff;">
    <tr>
      <td align="center" style="padding:16px;">
        <table role="presentation" width="640" cellspacing="0" cellpadding="0" border="0" style="width:640px;max-width:100%;">
          <tr>
            <td style="padding:0 0 12px 0;">
              <h1 style="margin:0 0 4px 0;font-size:20px;">{{ t("report.title") }}</h1>
              <div style="color:#666666;font-size:13px;">{{ t("report.subtitle") }}</div>
            </td>
          </tr>

          <tr>
            <td style="border:1px solid #e5e7eb;border-radius:8px;padding:12px;">
              <h2 style="margin:0 0 8px 0;font-size:16px;">{{ t("summary.overview") }}</h2>
              <div style="font-size:14px;">
                <div style="margin-bottom:4px;"><strong>{{ t("summary.total") }}:</strong> {{ metrics.total }}</div>
                <div style="margin-bottom:4px;"><strong>{{ t("summary.ok") }}:</strong> {{ "%.1f"|format(metrics.ok_pct) }}% ({{ metrics.ok }})</div>
                <div style="margin-bottom:4px;"><strong>{{ t("summary.warn") }}:</strong> {{ "%.1f"|format(metrics.warn_pct) }}% ({{ metrics.warn }})</div>
                <div style="margin-bottom:4px;"><strong>{{ t("summary.fail") }}:</strong> {{ "%.1f"|format(metrics.fail_pct) }}% ({{ metrics.fail }})</div>
              </div>
              <div style="margin-top:8px;color:#666666;font-size:12px;">{{ t("summary.note") }}</div>

              <div style="margin-top:12px;">
                <div style="font-weight:700;font-size:14px;margin:0 0 6px 0;">{{ t("toc.title") }}</div>
                <ul style="margin:0;padding-left:18px;">
                  {% for c in results %}
                    <li style="margin-bottom:4px;">
                      <a href="#clause-{{ c.id }}" style="color:#0b67c2;text-decoration:none;">{{ c.title }}</a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </td>
          </tr>

          {% for c in results %}
          {% set status = (c.status or "").upper() %}
          {% set badge_bg = "#d1fae5" if status == "OK" else ("#fef3c7" if status == "WARN" else "#fee2e2") %}
          {% set badge_fg = "#065f46" if status == "OK" else ("#92400e" if status == "WARN" else "#991b1b") %}

          <tr>
            <td id="clause-{{ c.id }}" style="border:1px solid #e5e7eb;border-radius:8px;padding:12px;margin-top:12px;">
              <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
                <h3 style="margin:0;font-size:16px;">{{ c.title }}</h3>
                <span style="display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700;background:{{ badge_bg }};color:{{ badge_fg }};border:1px solid {{ badge_fg }};">{{ status }}</span>
              </div>
              <div style="color:#666666;font-size:12px;margin-top:4px;">
                {{ t("clause.type") }}: {{ c.type }}
                {% if c.score is not none %} • {{ t("clause.score") }}: {{ c.score }}{% endif %}
                {% if c.risk_level %} • {{ t("clause.risk_level") }}: {{ c.risk_level }}{% endif %}
                {% if c.severity %} • {{ t("clause.severity") }}: {{ c.severity }}{% endif %}
              </div>

              {% if c.text %}
                <div style="white-space:pre-wrap;margin-top:8px;">{{ c.text }}</div>
              {% endif %}

              {% if c.problems and c.problems|length > 0 %}
                <div style="margin-top:8px;">
                  <strong>{{ t("clause.issues") }}:</strong>
                  <ul style="margin:6px 0 0 18px;">
                    {% for p in c.problems %}<li>{{ p }}</li>{% endfor %}
                  </ul>
                </div>
              {% endif %}

              {% if c.recommendations and c.recommendations|length > 0 %}
                <div style="margin-top:8px;">
                  <strong>{{ t("clause.recommendations") }}:</strong>
                  <ul style="margin:6px 0 0 18px;">
                    {% for r in c.recommendations %}<li>{{ r }}</li>{% endfor %}
                  </ul>
                </div>
              {% endif %}

              {% if c.law_reference and c.law_reference|length > 0 %}
                <div style="margin-top:8px;color:#666666;">
                  <strong>{{ t("clause.law_refs") }}:</strong>
                  <ul style="margin:6px 0 0 18px;">
                    {% for ref in c.law_reference %}<li>{{ ref }}</li>{% endfor %}
                  </ul>
                </div>
              {% endif %}

              {% if c.anchors and c.anchors.source_id %}
                <div style="margin-top:8px;">
                  <a href="#{{ c.anchors.source_id }}" style="color:#0b67c2;text-decoration:none;">
                    {{ t("clause.back_to_original") }}
                  </a>
                </div>
              {% endif %}
            </td>
          </tr>
          {% endfor %}

          <tr>
            <td style="padding:12px 0;color:#666666;font-size:12px;">&copy; {{ t("footer.app_name") }}</td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
