{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://contract-ai.tests/schema/analyze_response_v1_4.schema.json",
  "title": "AnalyzeResponse v1.4",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "status",
    "analysis",
    "results",
    "clauses",
    "document",
    "schema_version",
    "meta",
    "summary",
    "cid",
    "findings",
    "recommendations",
    "rules_coverage"
  ],
  "properties": {
    "status": {
      "type": "string"
    },
    "analysis": {
      "$ref": "#/$defs/AnalysisBlock"
    },
    "results": {
      "$ref": "#/$defs/ResultsBlock"
    },
    "clauses": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Finding"
      }
    },
    "document": {
      "type": "object",
      "additionalProperties": true
    },
    "schema_version": {
      "const": "1.4",
      "type": "string"
    },
    "meta": {
      "$ref": "#/$defs/Meta"
    },
    "summary": {
      "$ref": "#/$defs/DocumentSnapshot"
    },
    "cid": {
      "type": "string"
    },
    "findings": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Finding"
      }
    },
    "recommendations": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": true
      }
    },
    "rules_coverage": {
      "$ref": "#/$defs/RulesCoverage"
    }
  },
  "$defs": {
    "AnalysisBlock": {
      "type": "object",
      "required": [
        "findings",
        "status"
      ],
      "properties": {
        "findings": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Finding"
          }
        },
        "status": {
          "type": "string"
        }
      },
      "additionalProperties": true
    },
    "Finding": {
      "type": "object",
      "required": [
        "severity",
        "start",
        "end"
      ],
      "properties": {
        "rule_id": {
          "type": [
            "string",
            "null"
          ]
        },
        "clause_id": {
          "type": [
            "string",
            "null"
          ]
        },
        "clause_type": {
          "type": [
            "string",
            "null"
          ]
        },
        "severity": {
          "type": "string",
          "enum": [
            "critical",
            "high",
            "major",
            "medium",
            "minor",
            "low",
            "info"
          ]
        },
        "start": {
          "type": "integer",
          "minimum": 0
        },
        "end": {
          "type": "integer",
          "minimum": 0
        },
        "snippet": {
          "type": [
            "string",
            "null"
          ]
        },
        "normalized_snippet": {
          "type": [
            "string",
            "null"
          ]
        },
        "advice": {
          "type": [
            "string",
            "null"
          ]
        },
        "law_refs": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "citations": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Citation"
          }
        },
        "suggestion": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "object",
              "additionalProperties": true
            },
            {
              "type": "null"
            }
          ]
        },
        "conflict_with": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "ops": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": true
          }
        },
        "scope": {
          "type": "object",
          "properties": {
            "unit": {
              "type": "string"
            },
            "nth": {
              "type": "integer"
            }
          },
          "additionalProperties": true
        },
        "occurrences": {
          "type": "integer",
          "minimum": 0
        },
        "matched_triggers": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "trigger_positions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/SpanRange"
          }
        }
      },
      "additionalProperties": true
    },
    "SpanRange": {
      "type": "object",
      "properties": {
        "start": {
          "type": "integer",
          "minimum": 0
        },
        "end": {
          "type": "integer",
          "minimum": 0
        }
      },
      "required": [
        "start",
        "end"
      ],
      "additionalProperties": false
    },
    "Citation": {
      "type": "object",
      "properties": {
        "system": {
          "type": "string"
        },
        "instrument": {
          "type": "string"
        },
        "section": {
          "type": "string"
        },
        "url": {
          "type": [
            "string",
            "null"
          ]
        },
        "title": {
          "type": [
            "string",
            "null"
          ]
        },
        "source": {
          "type": [
            "string",
            "null"
          ]
        },
        "link": {
          "type": [
            "string",
            "null"
          ]
        },
        "score": {
          "type": [
            "number",
            "null"
          ]
        },
        "evidence": {
          "type": [
            "object",
            "null"
          ],
          "additionalProperties": true
        },
        "evidence_text": {
          "type": [
            "string",
            "null"
          ]
        }
      },
      "required": [
        "system",
        "instrument",
        "section"
      ],
      "additionalProperties": true
    },
    "DocumentSnapshot": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string"
        },
        "type_confidence": {
          "type": "number"
        },
        "type_source": {
          "type": [
            "string",
            "null"
          ]
        },
        "doc_type": {
          "type": "object",
          "properties": {
            "top": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string"
                },
                "score": {
                  "type": [
                    "number",
                    "null"
                  ]
                }
              },
              "required": [
                "type"
              ],
              "additionalProperties": true
            },
            "confidence": {
              "type": [
                "number",
                "null"
              ]
            },
            "candidates": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string"
                  },
                  "score": {
                    "type": [
                      "number",
                      "null"
                    ]
                  }
                },
                "required": [
                  "type"
                ],
                "additionalProperties": true
              }
            },
            "source": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          "required": [
            "top"
          ],
          "additionalProperties": true
        },
        "parties": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": true
          }
        },
        "dates": {
          "type": "object",
          "additionalProperties": {
            "type": [
              "string",
              "null"
            ]
          }
        },
        "term": {
          "type": "object",
          "properties": {
            "mode": {
              "type": "string"
            },
            "start": {
              "type": [
                "string",
                "null"
              ]
            },
            "end": {
              "type": [
                "string",
                "null"
              ]
            },
            "renew_notice": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          "additionalProperties": true
        },
        "governing_law": {
          "type": [
            "string",
            "null"
          ]
        },
        "jurisdiction": {
          "type": [
            "string",
            "null"
          ]
        },
        "signatures": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "liability": {
          "type": "object",
          "properties": {
            "has_cap": {
              "type": "boolean"
            },
            "cap_value": {
              "type": [
                "number",
                "null"
              ]
            },
            "cap_currency": {
              "type": [
                "string",
                "null"
              ]
            },
            "notes": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          "required": [
            "has_cap"
          ],
          "additionalProperties": true
        },
        "exclusivity": {
          "type": [
            "boolean",
            "null"
          ]
        },
        "currency": {
          "type": [
            "string",
            "null"
          ]
        },
        "carveouts": {
          "type": "object",
          "additionalProperties": true
        },
        "conditions_vs_warranties": {
          "type": "object",
          "properties": {
            "has_conditions": {
              "type": "boolean"
            },
            "has_warranties": {
              "type": "boolean"
            },
            "explicit_conditions": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "explicit_warranties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "required": [
            "has_conditions",
            "has_warranties"
          ],
          "additionalProperties": true
        },
        "hints": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "rules_count": {
          "type": "integer"
        },
        "debug": {
          "type": [
            "object",
            "null"
          ],
          "additionalProperties": true
        }
      },
      "required": [
        "type",
        "type_confidence",
        "parties",
        "dates",
        "term",
        "liability",
        "carveouts",
        "conditions_vs_warranties",
        "hints",
        "rules_count"
      ],
      "additionalProperties": true
    },
    "Meta": {
      "type": "object",
      "required": [
        "provider",
        "model",
        "valid_config",
        "document_type",
        "language",
        "text_bytes",
        "active_packs",
        "rules_loaded_count",
        "rules_fired_count",
        "rules_evaluated",
        "fired_rules",
        "pipeline_id",
        "timings_ms",
        "debug"
      ],
      "properties": {
        "provider": {
          "type": "string"
        },
        "model": {
          "type": "string"
        },
        "valid_config": {
          "type": "boolean"
        },
        "document_type": {
          "type": [
            "string",
            "null"
          ]
        },
        "language": {
          "type": "string"
        },
        "text_bytes": {
          "type": "integer"
        },
        "active_packs": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "rules_loaded_count": {
          "type": "integer"
        },
        "rules_fired_count": {
          "type": "integer"
        },
        "rules_evaluated": {
          "type": "integer"
        },
        "fired_rules": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/FiredRule"
          }
        },
        "pipeline_id": {
          "type": "string"
        },
        "timings_ms": {
          "type": "object",
          "properties": {
            "parse_ms": {
              "type": "number"
            },
            "classify_ms": {
              "type": "number"
            },
            "load_rules_ms": {
              "type": "number"
            },
            "run_rules_ms": {
              "type": "number"
            }
          },
          "additionalProperties": true
        },
        "debug": {
          "type": "object",
          "properties": {
            "pipeline": {
              "type": "string"
            },
            "packs": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "rules_loaded": {
              "type": "integer"
            },
            "rules_evaluated": {
              "type": "integer"
            },
            "rules_triggered": {
              "type": "integer"
            }
          },
          "additionalProperties": true
        },
        "companies_meta": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "from_document": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": [
                      "string",
                      "null"
                    ]
                  },
                  "number": {
                    "type": [
                      "string",
                      "null"
                    ]
                  }
                },
                "additionalProperties": true
              },
              "matched": {
                "type": [
                  "object",
                  "null"
                ],
                "additionalProperties": true
              },
              "verdict": {
                "type": "string"
              }
            },
            "additionalProperties": true
          }
        }
      },
      "additionalProperties": true
    },
    "FiredRule": {
      "type": "object",
      "properties": {
        "rule_id": {
          "type": [
            "string",
            "null"
          ]
        },
        "pack": {
          "type": [
            "string",
            "null"
          ]
        },
        "matched_triggers": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "requires_clause_hit": {
          "type": "boolean"
        },
        "positions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/SpanRange"
          }
        }
      },
      "required": [
        "rule_id",
        "requires_clause_hit",
        "positions"
      ],
      "additionalProperties": true
    },
    "RulesCoverage": {
      "type": "object",
      "required": [
        "doc_type",
        "rules"
      ],
      "properties": {
        "doc_type": {
          "type": "object",
          "properties": {
            "value": {
              "type": [
                "string",
                "null"
              ]
            },
            "source": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          "required": [
            "value"
          ],
          "additionalProperties": true
        },
        "rules": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "rule_id": {
                "type": [
                  "string",
                  "null"
                ]
              },
              "status": {
                "type": [
                  "string",
                  "null"
                ]
              }
            },
            "required": [
              "rule_id",
              "status"
            ],
            "additionalProperties": true
          }
        }
      },
      "additionalProperties": true
    },
    "ResultsBlock": {
      "type": "object",
      "required": [
        "summary"
      ],
      "properties": {
        "summary": {
          "$ref": "#/$defs/DocumentSnapshot"
        }
      },
      "additionalProperties": true
    }
  }
}
